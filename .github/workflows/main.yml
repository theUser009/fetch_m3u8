# name: Anime Scraper (Every 3 Hours or on app.py change)

# on:
#   schedule:
#     - cron: "0 */3 * * *"   # â° Every 3 hours
#   push:
#     paths:
#       - "app.py"            # ğŸ§  Only trigger if app.py changes
#   workflow_dispatch:         # â–¶ï¸ Allow manual trigger

# permissions:
#   contents: write  # âœ… Needed for committing back to repo

# concurrency:
#   group: anime-scraper-group
#   cancel-in-progress: true   # ğŸ›‘ Cancel previous run if a new one starts

# jobs:
#   scrape:
#     runs-on: ubuntu-latest
#     timeout-minutes: 175  # â³ 2h 55m max runtime

#     steps:
#       - name: ğŸ§© Checkout repo
#         uses: actions/checkout@v4

#       - name: ğŸ Setup Python
#         uses: actions/setup-python@v5
#         with:
#           python-version: "3.12"

#       - name: ğŸ“¦ Install dependencies
#         run: |
#           echo "ğŸ“¦ Installing dependencies..."
#           pip install -r requirements.txt

#       - name: ğŸš€ Run scraper
#         env:
#           MAX_ID: 500000        # adjust upper limit per need
#           KEYS: ${{ secrets.KEYS }}
#         run: |
#           echo "â³ Starting scrape run..."
#           python app.py
#           echo "âœ… Scrape completed or timed out (2h55m limit)."

#       - name: ğŸ’¾ Commit updated binaries and progress
#         run: |
#           echo "ğŸ’¾ Checking for updated files..."
#           git config --global user.name "github-actions[bot]"
#           git config --global user.email "github-actions[bot]@users.noreply.github.com"
#           git add anime_bins/*.bin progress.txt || true
#           git commit -m "Update anime data & progress [$(date +'%Y-%m-%d %H:%M:%S')]" || echo "No changes to commit"
#           git push || echo "No changes to push"

#       - name: âœ… Workflow finished
#         run: echo "ğŸ‰ Anime scrape workflow completed successfully."
